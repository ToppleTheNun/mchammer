generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_PRISMA_URL")
}

model DodgeParryMissStreak {
  id String @id @default(cuid())

  report                   String
  reportFightId            Int
  reportFightRelativeStart Int      @default(-1)
  reportFightRelativeEnd   Int      @default(-1)
  dodge                    Int
  parry                    Int
  miss                     Int
  streak                   Int
  timestampStart           DateTime
  timestampEnd             DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  source   Character @relation(fields: [sourceId], references: [id])
  sourceId Int

  fight   Fight  @relation(fields: [fightId], references: [id])
  fightId String
}

model Character {
  id Int @id

  name   String
  server String
  region Regions

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  wordOfGlorys DodgeParryMissStreak[]
}

model Fight {
  id String @id @default(cuid())

  firstSeenReport String
  startTime       DateTime
  endTime         DateTime
  difficulty      Int
  encounterId     Int
  // colon separated list of ints
  friendlyPlayers String
  region          Regions

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  wordOfGlorys DodgeParryMissStreak[]

  @@unique([startTime, endTime, encounterId, friendlyPlayers, region])
}

enum Regions {
  eu
  kr
  tw
  us
}
